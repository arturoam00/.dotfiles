#!/bin/bash
set -eu

tag="bluetooth_tag"

choice=$(bluetoothctl devices Trusted 2>/dev/null | tofi)

[ -z "$choice" ] && echo "Cancel operation" && exit 0

uuid=$(printf "%s\n" "$choice" | awk '{print $2}')
label=$(printf "%s\n" "$choice" | cut -d' ' -f3-)

if bluetoothctl connect "$uuid"; then
    dunstify \
        -a "bluetooth" \
        -i "bluetooth-active" \
        -u normal \
        -h string:x-dunst-stack-tag:"$tag" \
        "$label connected ✓"
else
    dunstify \
        -a "bluetooth" \
        -u critical \
        -h string:x-dunst-stack-tag:"$tag" \
        "Couldn't connect to $label "
fi
